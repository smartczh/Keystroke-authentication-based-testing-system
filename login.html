<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <link rel="stylesheet" href="css/bootstrap.css"/>
    <link rel="stylesheet" href="css/login.css"/>
    <link rel="stylesheet" href="css/footer&cbl.css"/>
    <link rel="stylesheet" href="css/daohang.css"/>
    <script type="text/javascript" src="js/jquery-1.11.3.js"></script>
    <script type="text/javascript" src="js/bootstrap.js"></script>
    <script type="text/javascript" src="js/templet.js"></script>
    <script type="text/javascript" src="js/hp.js"></script>
    <title></title>
</head>
<body>
<div id="main">
    <nav class=" navbar-inverse" id="daohang">
        <div class="daohang">
            <div class="navbar-header clearfix">
                <button type="button" class="zd" id="zd">
                    <span class="glyphicon glyphicon-align-justify"></span>
                </button>
            </div>
            <div class="collapse navbar-collapse" id="daohangtiao">
                <span class="close"><a href="index.html"><i></i></a></span>
            </div>
        </div>
        <div id="box">
            <div class="box1 col-sm-2 col-xs-2">
                <span id="X" class="glyphicon glyphicon-remove pull-right"></span>
            </div>
            <div class="box2 col-sm-10 col-xs-10">
                <ul id="ul1" class="clearfix">
                    <li><a href="index.html">首页</a></li>
                    <li><a href="templet.html">模板</a></li>
                    <li><a href="setmeal.html">套餐</a></li>
                    <li><a href="example.html">案例</a></li>
                    <li id="wd"><a>文档<i class="glyphicon glyphicon-menu-right"></i></a></li>
                    <li id="gy"><a>关于<i class="glyphicon glyphicon-menu-right"></i></a></li>
                </ul>
                <div id="wd1">
                    <ul>
                        <li id="fanhui1"><a>返回上一级</a></li>
                        <li><a>教程中心</a></li>
                        <li><a>建站资讯</a></li>
                        <li><a>更新日志</a></li>
                    </ul>
                </div>
                <div id="gy1">
                    <ul id="ul2">
                        <li id="fanhui2"><a>返回上一级</a></li>
                        <li id="gcxx"><a>公司信息<i class="glyphicon glyphicon-menu-right"></i></a></li>
                        <li><a>荣誉资质</a></li>
                        <li><a>联系客服</a></li>
                    </ul>
                </div>
                <div id="gc">
                    <ul>
                        <li id="fanhui3"><a>返回上一级</a></li>
                        <li><a>公司介绍</a></li>
                        <li><a>服务条款</a></li>
                        <li><a>法律声明</a></li>
                        <li><a>可接受服务</a></li>
                        <li><a>免责声明</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>
    <div class="main">
        <div class="container">
            <div class="c2">
                <a href=""></a><span>
						<img src="img/qifeiye.png"/>
					</span></a>
                <p>从这里开启建站之旅</p>
            </div>
            <div class="c3">
                <form id="form-login">
                    <div class="form-group">
                        <label for="input-username">用户名</label>
                        <input type="text" class="form-control" id="input-username">
                    </div>
                    <div class="form-group">
                        <label for="input-password">密码</label>
                        <input type="text" class="form-control" id="input-password" autocomplete="off">
                    </div>
                    <div class="checkbox">
                        <label>
                            <input type="checkbox"> 记住我（请在私人计算机上使用此功能）
                        </label>
                    </div>

                    <div class="c3-1">
                        <button id="button-show-figure" class="btn btn-default btn1" type="button"
                                style="width: 100%; margin-top: 10px; display: none" data-toggle="modal"
                                data-target="#myModal">显示特性
                        </button>
                        <button id="button-login" type="submit" class="btn btn-default btn1">登录</button>
                        <a href="register.html" type="button" class="btn btn-default btn2">注册</a>
                    </div>
                    <div class="c3-2 clearfix">
                        <span class="c3-2-2">其他账号登录：</span>
                        <div class="c3-2-1">
                            <a href="" title="使用腾讯QQ登录"><span class="s1"></span></a>
                            <a href="" title="使用微信登录"><span class="s2"></span></a>
                            <a href="" title="使用谷歌登录"><span class="s3"></span></a>
                            <a href="" title="使用脸书登录"><span class="s4"></span></a>
                        </div>
                    </div>
                    <div class="c3-3 clearfix">
                        <a href="" class="pull-right">忘记密码？点这里找回</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <ul class="cbl">
        <li><a href="#">
            <div class="icon d1"><i class="i1"></i><span class="title">在线客服</span></div>
        </a></li>
        <i class="clearfix"></i>
        <li><a href="#">
            <div class="icon d2"><i class="i2"></i><span class="title">4006285729</span></div>
        </a></li>
        <i class="clearfix"></i>
        <li><a href="#">
            <div class="icon"><i class="i3"></i><span class="title">教程中心</span></div>
        </a></li>
        <i class="clearfix"></i>
        <li><a href="#">
            <div class="icon d4" data-toggle="tooltip" data-placement="left"
                 title="<img src='img/erweima.png'><br/> 关注微信 " data-html="true"><i class="i4"></i></div>
        </a></li>
    </ul>
</div>

<!-- 模态框 -->
<div class="modal fade" id="myModal">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">

            <!-- 模态框头部 -->
            <div class="modal-header">
                <h4 class="modal-title">击键特性</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>

            <!-- 模态框主体 -->
            <div class="modal-body">
                <div id="div-htFigure">

                </div>
                <div id="div-ftFigure">

                </div>
            </div>

            <!-- 模态框底部 -->
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
            </div>

        </div>
    </div>
</div>


</body>
<script type="text/javascript" src="js/myJS/settings.js"></script>
<script type="text/javascript" src="js/myJS/tools.js"></script>
<script src="http://cdn.highcharts.com.cn/highcharts/highcharts.js"></script>
<script type="text/javascript">
    let pressTimeObject = [];
    let releaseTimeObject = [];
    $("#input-password").keydown(function (event) {//keypress 事件与 keydown 事件类似。当按钮被按下时发生该事件。然而，keypress 事件不会触发所有的键（比如 ALT、CTRL、SHIFT、ESC）。请使用 keydown() 方法来检查这些键。
        let currTime = Date.now();
        let currCharNum = event.which;
        //todo 判断是否是特殊键，以及优化时间考虑（先获取时间再判断）
        if (currCharNum == 13) {//回车键的处理
            $("#button-login").click();
            event.preventDefault();
            return false;
        }
        if (currCharNum == 8) {//退格键的处理
            alert("需要一次性输对密码");
            flush();
            return;
        }
        pressTimeObject.push(currTime);
    });

    $("#input-password").keyup(function (event) {
        let currTime = Date.now();
        let currCharNum = event.which;
        //todo 判断是否是特殊键，以及优化时间考虑（先获取时间再判断）
        if (currCharNum == 13) {//回车键的处理
            return;
        }
        if (currCharNum == 8) {//退格键的处理
            return;
        }
        if (currCharNum == 9) {//tab键的处理
            return;//由上一个输入框转过来的，不记录时间戳
        }
        releaseTimeObject.push(currTime);
    });

    function flush() {//清空输入框数据
        pressTimeObject = [];
        releaseTimeObject = [];
        $("#input-password").val("");
    }

    $("#form-login").submit(function (event) {
        event.preventDefault();
        let username = $("#input-username").val();
        let password = $("#input-password").val();
        if (username == "") {
            alert("用户名为空");
            return;
        }
        if (password == "") {
            alert("密码为空");
            return;
        }
        if (pressTimeObject.length != releaseTimeObject.length) {
            alert("击键异常，请重新登录");
            return;
        }
        if (pressTimeObject.length != password.length) {
            alert("请勿在输入中包含功能键");
            return;
        }
        let data = {};
        data.user = {};
        data.user.username = username;
        data.user.password = password;
        data.pressTimeObject = pressTimeObject;
        data.releaseTimeObject = releaseTimeObject;
        $.ajax({
            url: service_url + "/user/login",
            type: "POST",
            contentType: "application/json",
            dataType: "json",
            data: JSON.stringify(data),
            success: function (data, status) {
                alert(data.message);
                if(data.loginFeature == null){//服务器未返回对比数据，不需要图形对比
                    return;
                }
                $("#button-show-figure").show();
                //图形分析
                let password = $("#input-password").val();
                $("#button-show-figure").click(function () {
                    let htCategories = [];
                    for (let i = 0; i < password.length; i++) {
                        htCategories.push(password[i]);
                    }
                    let htData = FeatureToHtdataForm(data.loginFeature, data.claimFeature);
                    let htChart = Highcharts.chart('div-htFigure', {
                        chart: {
                            type: 'line'
                        },
                        title: {
                            text: '单键持续时间对比'
                        },
                        credits: {
                            enabled: false     //不显示LOGO
                        },
                        xAxis: {
                            categories: htCategories
                        },
                        yAxis: {
                            title: {
                                text: '时间(ms)'
                            }
                        },
                        series: htData
                    });

                    let ftCategories = [];
                    for (let i = 1; i < password.length; i++) {
                        ftCategories.push(password[i - 1] + password[i]);
                    }
                    let ftData = FeatureToFtdataForm(data.loginFeature, data.claimFeature);
                    let ftChart = Highcharts.chart('div-ftFigure', {
                        chart: {
                            type: 'line'
                        },
                        title: {
                            text: '双键飞行时间对比'
                        },
                        credits: {
                            enabled: false     //不显示LOGO
                        },
                        xAxis: {
                            categories: ftCategories
                        },
                        yAxis: {
                            title: {
                                text: '时间(ms)'
                            }
                        },
                        series: ftData
                    });
                });
            },
            error: function (message) {
                alert("登录请求失败");
            }
        });
    });
</script>
</html>
